<center>
<%
	require 'open-uri/cached'
	require 'nokogiri'
 	require 'xmlsimple'
 	require 'addressable/uri'
 	require 'cgi'

	# feed = open("http://raymperry.com/Ecal%20XMLSample.xml")
	feed = Nokogiri::XML(open('http://www.google.com/search?q=sparklemotion'))

	docElem = XmlSimple.xml_in(feed, {'ForceArray' => false}) %>

		<br/>
		<style type='text/css'>
			table {background-color:#fff;color:#000;}
			th {
				background-color:#999;
				padding-left: 10px;
				padding-right: 10px;
			}
			.active {
				background-color:#ccc;
			}
			.inactive {
				background-color:#888;
			}
		</style>
		
		<%
		dates = []
		docElem['Table'].each do |table|
			if !dates.include? table['REDATE']
				dates << table['REDATE']
			end
		end

		dates = dates.sort
		%>
		
		<form action=''><select>
		<p><%=
		uri = Addressable::URI.parse("http://example.com/path/to/resource/")
		uri.path
		%></p>

		<%=
		page = ''
		dates.each do |date|
			page += "<option value='#{date}'>#{date}</option>"
		end
		page.html_safe
		%>

		</select>

		<input type='checkbox' value='weekly' />Weekly</form>

		<%= time_zone_select( "user", 'time_zone', ActiveSupport::TimeZone.us_zones, :default => "Pacific Time (US & Canada)") %>

		<div id="moreInfoPopup" style="
			cursor:default;
			display:none;
			position:fixed;
			left:50%;
			top:50%;
			background-color:#fff;
			border-style:solid;
			border-width:5px;
			border-color:#000;
			width: 550px;
			height:350px;
			margin-left: -275px;
			margin-top: -175px;
			text-align:center;
			padding:5px;
			overflow:auto;">


			<div style="padding:0 auto; text-align:center; background-color:#777;"><h1>EVENT DETAILS</h1></div><br/>

			<div style="text-align:left;">
			<p id="moreInfoName"></p>
			<p id="moreInfoDateTime"></p>
			<p id="moreInfoCountry"></p>
			<p id="moreInfoEventType"></p><br/>
			<p id="moreInfoPrevious"></p>
			<p id="moreInfoForecast"></p>
			<p id="moreInfoActual"></p><br/>
			</div>

			<div id="moreInfoDescDrawer" class="inactive" style="
				float:left;
				border-style:solid;
				border-width:1px;
				border-color:#000;
				padding:0;
				width:75px;
				height:24px;
				margin:0;
				text-align:center;
				color:#000;">Description</div>
			<div id="moreInfoHistDrawer" class="inactive" style="
				float:left;
				border-style:solid;
				border-width:1px;
				border-color:#000;
				padding:0;
				width:75px;
				height:24px;
				margin:0;
				text-align:center;
				color:#000;">History</div>
			<div id="moreInfoChartDrawer" class="inactive" style="
				float:left;
				border-style:solid;
				border-width:1px;
				border-color:#000;
				padding:0;
				width:75px;
				height:24px;
				margin:0;
				text-align:center;
				color:#000;">Chart</div>


			<div id="moreInfoDescTab" style="
				clear:both;
				border-style:solid;
				border-width:1px;
				border-color:#000;
				padding:5px;
				text-align:left;">
				<p id="descTabImportance"></p>
				<p id="descTabSource"></p>
				<p id="descTabRelease"></p>
				<p id="descTabDescription"></p>
			</div>
			<div id="moreInfoHistTab" style="
				clear:both;
				border-style:solid;
				border-width:1px;
				border-color:#000;
				padding:5px;
				text-align:left;">
				<p>No records to date about this event.</p>
			</div>
			<div id="moreInfoChartTab" style="
				clear:both;		
				border-style:solid;
				border-width:1px;
				border-color:#000;
				padding:5px;
				text-align:left;">
				<p>Charting function goes here.</p>
			</div><br/>

			

			<a id="closePop" href='#'>Close window</a><br/><br/>


		</div>


		<table>
			<th>Serial Number</th>
			<th>Release Date</th>
			<th>Release Time</th>
			<th>Release Date/Time</th>
			<th>Country Name</th>
			<th>Frequency</th>
			<th>Relevance</th>
			<th>Indicator Name</th>
			<th>Indicator Type</th>
			<th>Indicator Source</th>
			<th>Indicator Description</th>
			<th>Actual Value</th>
			<th>Forecast Value</th>
			<th>Previous Value</th>
			<th>For Period</th>
			<th>Source Link</th>
			<th>Indicator Sub Type</th>
			<th>Currency Name</th>
			<th>Country Flag</th>
		
<%=
	newTbl = ''
	count = 0
	docElem['Table'].each do |table|
		count += 1
		newTbl += "<tr id='elem#{count}'>"
		newTbl += "<td data-id='M008CODE'>" + table['M008CODE'] + "</td>"
		newTbl += "<td data-id='REDATE'>" + table['REDATE'] + "</td>"
		newTbl += "<td data-id='RETIME'>" + table['RETIME'] + "</td>"
		newTbl += "<td data-id='DATECOL2'>" + table['DATECOL2'] + "</td>"
		newTbl += "<td data-id='COUNTRY'>" + table['COUNTRY'] + "</td>"
		newTbl += "<td data-id='FREQUENCY'>" + table['FREQUENCY'] + "</td>"
		newTbl += "<td data-id='RELEVANCE'>" + table['RELEVANCE'] + "</td>"
		newTbl += "<td data-id='INDNAME'><a class='moreInfoTog' href=#>" + table['INDNAME'] + "</a></td>"
		newTbl += "<td data-id='INDTYPE'>" + table['INDTYPE'] + "</td>"
		newTbl += "<td data-id='INDSOURCE'>" + table['INDSOURCE'] + "</td>"
		newTbl += "<td data-id='INDDESC'>" + table['INDDESC'] + "</td>"
		newTbl += "<td data-id='ACTUAL'>" + table['ACTUAL'] + "</td>"
		newTbl += "<td data-id='FORCAST'>" + table['FORCAST'] + "</td>"
		newTbl += "<td data-id='PREVIOUS'>" + table['PREVIOUS'] + "</td>"
		newTbl += "<td data-id='PERIOD'>" + table['PERIOD'] + "</td>"
		newTbl += "<td data-id='SOURCELINK'>" + table['SOURCELINK'] + "</td>"
		newTbl += "<td data-id='EVENTSUBTYP'>" + table['EVENTSUBTYP'] + "</td>"
		newTbl += "<td data-id='CURRNCY'>" + table['CURRNCY'] + "</td>"
		newTbl += "<td data-id='COUNTRYFLAG'>" + table['COUNTRYFLAG'] + "</td>"
		newTbl += "</tr>"
	end

	newTbl += "</table>"
	newTbl.html_safe
%>
</center>