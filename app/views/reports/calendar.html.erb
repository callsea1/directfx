<center>
<%
	require 'open-uri/cached'
	require 'erubis'
 	require 'xmlsimple'


	feed = open("http://raymperry.com/Ecal%20XMLSample.xml")
	# feed = open("http://ecal.decimalpointanalytics.info/directfxxml.aspx")

	docElem = XmlSimple.xml_in(feed, {'ForceArray' => false}) %>

			<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
			<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
			<script src="//raymperry.com/jquery.cf.popover.min.js"></script>
			<script src="//raymperry.com/jquery.ui.position.min.js"></script>-->
			<br/>
			<style type='text/css'>
				table {background-color:#fff;color:#000;}
				th {
					background-color:#999;
					padding-left: 10px;
					padding-right: 10px;
				}
			</style>
			
			<%
			dates = []
			docElem['Table'].each do |table|
				if !dates.include? table['REDATE']
					dates << table['REDATE']
				end
			end

			dates = dates.sort
			%>
			
			<form action=''><select>
			<%=
			page = ''
			dates.each do |date|
				page += "<option value='#{date}'>#{date}</option>"
			end
			page.html_safe
			%>

			</select>

			<input type='checkbox' value='weekly' />Weekly</form>

			<%= time_zone_select( "user", 'time_zone', ActiveSupport::TimeZone.us_zones, :default => "Pacific Time (US & Canada)") %>

			<div id="moreInfoPopup" style="
				display:none;
				position:fixed;
				left:50%;
				top:50%;
				background-color:#fff;
				border-style:solid;
				border-width:5px;
				border-color:#000;
				width: 250px;
				height:250px;
				margin-left: -125px;
				margin-top: -125px;">


				<p id="moreInfoPopupText"></p>

				<a id="closePop" href='#'>Close window</a>


			</div>


			<table>
				<th>Serial Number</th>
				<th>Release Date</th>
				<th>Release Time</th>
				<th>Release Date/Time</th>
				<th>Country Name</th>
				<th>Frequency</th>
				<th>Relevance</th>
				<th>Indicator Name</th>
				<th>Indicator Type</th>
				<th>Indicator Source</th>
				<th>Indicator Description</th>
				<th>Actual Value</th>
				<th>Forecast Value</th>
				<th>Previous Value</th>
				<th>For Period</th>
				<th>Source Link</th>
				<th>Indicator Sub Type</th>
				<th>Currency Name</th>
				<th>Country Flag</th>
			
<%=
	newTbl = ''
	count = 0
	docElem['Table'].each do |table|
		count += 1
		newTbl += "<tr id='elem#{count}'>"
		newTbl += "<td data-id='M008CODE'>" + table['M008CODE'] + "</td>"
		newTbl += "<td data-id='REDATE'>" + table['REDATE'] + "</td>"
		newTbl += "<td data-id='RETIME'>" + table['RETIME'] + "</td>"
		newTbl += "<td data-id='DATECOL2'>" + table['DATECOL2'] + "</td>"
		newTbl += "<td data-id='COUNTRY'>" + table['COUNTRY'] + "</td>"
		newTbl += "<td data-id='FREQUENCY'>" + table['FREQUENCY'] + "</td>"
		newTbl += "<td data-id='RELEVANCE'>" + table['RELEVANCE'] + "</td>"
		newTbl += "<td data-id='INDNAME'><a class='moreInfoTog' href=#>" + table['INDNAME'] + "</a></td>"
		newTbl += "<td data-id='INDTYPE'>" + table['INDTYPE'] + "</td>"
		newTbl += "<td data-id='INDSOURCE'>" + table['INDSOURCE'] + "</td>"
		newTbl += "<td data-id='INDDESC'>" + table['INDDESC'] + "</td>"
		newTbl += "<td data-id='ACTUAL'>" + table['ACTUAL'] + "</td>"
		newTbl += "<td data-id='FORCAST'>" + table['FORCAST'] + "</td>"
		newTbl += "<td data-id='PREVIOUS'>" + table['PREVIOUS'] + "</td>"
		newTbl += "<td data-id='PERIOD'>" + table['PERIOD'] + "</td>"
		newTbl += "<td data-id='SOURCELINK'>" + table['SOURCELINK'] + "</td>"
		newTbl += "<td data-id='EVENTSUBTYP'>" + table['EVENTSUBTYP'] + "</td>"
		newTbl += "<td data-id='CURRNCY'>" + table['CURRNCY'] + "</td>"
		newTbl += "<td data-id='COUNTRYFLAG'>" + table['COUNTRYFLAG'] + "</td>"
		newTbl += "</tr>"
	end

	newTbl += "</table>"
	newTbl.html_safe
%>
</center>