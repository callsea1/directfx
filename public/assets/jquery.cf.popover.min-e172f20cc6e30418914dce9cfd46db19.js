!function(t){var o=t.ui.position,e=function(o,e){this.opts=t.extend({},this.opts,e),this.$trigger=t(o.get(0)),this.$popover=t(this.opts.popover||this.$trigger.attr("href")),this.$popover=t(this.$popover.get(0)),this.$popover.hasClass("popover-before-after-applied")||this.$popover.addClass("popover-before-after-applied").prepend('<span role="presentation" class="before"/>').append('<span role="presentation" class="after"/>').hide()};e.prototype={timeout:null,$win:t(window),opts:{my:"center bottom",at:"center top",offset:"0 0",collision:"flop flop",popover:null,thereCanBeOnlyOne:!0},flop:{left:function(e,i){var r=t(this),p=e.left,s=o.flip.left(e,i);return r.toggleClass("flopped-x",void 0!==e.left&&e.left!==p),s},top:function(e,i){var r=t(this),p=e.top,s=o.flip.top(e,i);return r.toggleClass("flopped-y",void 0!==e.top&&e.top!==p),s}},bindEvents:function(){this.$trigger.click(t.proxy(function(o){this.popoverIsOpen()?this.hidePopover(o):this.showPopover(o),this.opts.thereCanBeOnlyOne&&t("body").trigger("popover-hide-all")},this)),t("body").click(t.proxy(function(o){this.popoverIsOpen()&&(t(this.$popover).has(t(o.target)).size()||t(this.$popover).filter(t(o.target)).size()||this.hide())},this)).bind("popover-hide-all",t.proxy(function(){this.popoverIsOpen()&&!this.currentTrigger()&&this.hide(!0)},this)),this.$win.resize(t.proxy(this.pinToTargetDebounced,this))},popoverIsOpen:function(){var t=this.$trigger.length==this.$trigger.filter(this.$popover.data("opener")).length;return this.$popover.is(":visible")&&t},currentTrigger:function(){return this.$trigger.length==this.$trigger.filter(t.fn.popover.lastTrigger).length},show:function(){t.fn.popover.lastTrigger=this.$trigger,this.$popover.fadeIn("medium",t.proxy(function(){this.$trigger.trigger("popover-show-animation-complete")},this)).data("opener",this.$trigger),this.pinToTarget(),this.$trigger.trigger("popover-show")},hide:function(o){var e=t.proxy(function(){this.$trigger.trigger("popover-hide-animation-complete")},this);o?this.$popover.hide(0,e):this.$popover.fadeOut("fast",e),this.$trigger.trigger("popover-hide")},toggle:function(t){this.popoverIsOpen()?this.hide(t):this.show()},showPopover:function(t){t.preventDefault(),t.stopPropagation(),this.show(t)},hidePopover:function(t){t.preventDefault(),t.stopPropagation(),this.hide()},pinToTarget:function(){if(this.popoverIsOpen()){var e=this.$popover,i=t.extend({of:this.$trigger},this.opts),r={left:t.proxy(this.flop.left,this.$popover),top:t.proxy(this.flop.top,this.$popover)};o.flop=r,e.position(i),o.flop=void 0}},pinToTargetDebounced:function(){clearTimeout(this.timeout),this.timeout=setTimeout(t.proxy(this.pinToTarget,this),50)}};var i=t.fn;i.popover=function(o){var e=i.popover.Popover;return this.each(function(){var i=t(this),r=new e(i,o);r.bindEvents(),i.data("popover",r)}),this},i.popover.lastTrigger=null,i.popover.Popover=e}(jQuery);